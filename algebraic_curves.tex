\section{Varieties and Curves}

In this section we will introduce all the prerequisites to start studying
elliptic curves and the Weil conjectures.

\subsection{Algebraic Varieties}

For the Weil conjectures we will be concerned with counting the
number of points on an algebraic variety that have coordinates
in some subfield of $L \subset K$. In order for this to make sense
the variety $V$ in question has to be given by polynomials whose
coefficients all lie in $L$, otherwise the notion of points belonging to $L$
is not invariant by isomorphism. For example the curves defined
over $C$ given by the equations $y = x + a$ for $a$ irrational
are isomorphic to $\A^1$, but their sets of rational points (the
sets of points which has coordinates lying in $\Q$) are different
(one being the empty set, while the other being $\Q\subset\A^1$).

\begin{definition}
	Let $V$ be a algebraic variety. Let $L$ be a subfield of $K$.
	We say that $V$ is \emph{defined over} $L$ when the ideal of
	$V$ can be generated by polynomials in $L[X]$.
	We will denote this by $V/L$.
\end{definition}

A point whose coordinates belong to a certain subfield $L \subset K$
is called an $L$-rational point. The following definition makes this
precise

\begin{definition}
	Let $L \subseteq K$ a subfield.
	We define the set $\A^n(L) \subseteq \A^n$ as
	\begin{equation*}
		\A^n(L) := \{(x_1, \dots, x_n) \in \A^n \mid x_i \in L\}.
	\end{equation*}
	We call this set the \emph{set of $L$-rational} points of $\A^n$.
	Similarly, we define
	\begin{equation*}
		\proj^n(L) := \{[x_1, \dots, x_{n+1}] \in \proj^n \mid x_i \in L\},
	\end{equation*}
	the set of $L$-rational points of $\proj^n$.
\end{definition}

For an algebraic variety defined over $L$,
we can then talk about its $L$-rational points.

\begin{definition}
	Let $L \subset K$ a subfield.
	Let $V/L$ be an algebraic variety defined over $L$.
 	We define the set
	of $L$-rational points of $V$
	\begin{equation*}
		V(L) := 
		\begin{cases}
			V\cap\A^n(L) &\textrm{if $V$ is affine;}\\
			V\cap\proj^n(L) &\textrm{if $V$ is projective.}
		\end{cases}
	\end{equation*}
\end{definition}

In this paper we will be primarily interested in \emph{smooth}
projective varieties.
We will first define what this means for affine varieties and then extend
the definition to projective varieties.

\begin{definition}
	Let $V \subseteq \A^n$ be an affine variety, $P \in V$ and 
	$f_1, \dots, f_m \in K[X_1, \dots, X_n]$ a set of generators of $I(V)$.
	Then $V$ is \emph{non-singular}, or \emph{smooth} at $P$ if the Jacobian
	of $(f_1, \dots, f_m)$ at $P$ has rank $n - \dim(V)$. In the other case we
	say $P$ is a singular point of $V$.
	If $V$ is non-singular at every point, then $V$ is \emph{non-singular},
	or \emph{smooth}.
\end{definition}

We remind that
projective space $\proj^n$ can be covered by copies of $\A^n$. Define
\begin{equation*}
	U_i := \{[x_0, \dots, x_n] \in \proj^n \mid x_i \neq 0\},
\end{equation*}
then $U_i$ is isomorphic to $\A^n$ via the chart
\begin{equation*}
	\phi_i: U_i \to \A^n, [x_0, \dots, x_n]
	\mapsto \left(\frac{x_1}{x_i}, \dots,
		\frac{x_{i-1}}{x_i}, \frac{x_{i+1}}{x_i}, \dots, 
		\frac{x_n}{x_i}\right)
\end{equation*}

Now we can define smoothness for projective varieties.

\begin{definition}
	Let $V \subseteq \proj^n$ be a projective variety,
	$P \in V$ and choose $U_i \subseteq \proj^n$ such
	that $P \in U_i$. Then $V$ is \emph{non-singular}, or \emph{smooth}
	at $P$ if $V \cap U_i$ is smooth at $P$ (as an affine variety).
\end{definition}

Let us remind some important definitions from the course
\emph{Algebraic curves}.

\begin{definition}
	Let $V \subset \proj^n$ be a quasi-projective variety. A map $f: V \to K$
	is regular at $P \in V$ if there exists some open neighbourhood
	$U \subset V$ of $P$ and $g, h \in K[X_1, \dots, X_{n+1}]$
	homogeneous of the same degree such that $h(u) \neq 0$
	and $f(u) = g(u)/h(u)$ for all $u \in U$.

	The ring of regular functions on $V$ is denoted $\O(V)$.
\end{definition}

\begin{definition}
	\label{def:regular}
	A morphism between two algebraic varieties $V, W$ is a continuous map
	$\phi: V \to W$ such that for every open set $U \subset W$
	and every $f \in \O(U)$, the map
	\begin{equation*}
		f\circ\phi: \phi^{-1}(U) \to K
	\end{equation*}
	is regular.
\end{definition}

We will make use of an equivalent definition of morphisms for
projective varieties that is easier to 
manipulate in practice. First we define the notion of a rational map.

\begin{definition}
	Let $V_1 \subseteq \proj^n, V_2 \subseteq \proj^m$ be projective varieties.
	A \emph{rational map} from $V_1$ to $V_2$ is a map of the form
	\begin{align*}
		\phi: V_1 &\to V_2\\
		P &\mapsto [f_0(P), \dots, f_m(P)],
	\end{align*}
	where $f_0, \dots, f_m \in K(V_1)$ are such that
	for all $P \in V_1$ at which $f_0, \dots, f_n$ are all defined, 
	$\phi(P) \in V_2$.
\end{definition}

We can now define the notion of regularity rational maps.
Naively, we would like to say a rational map is regular at $P$ if its
constituent maps $f_i$ are all regular at $P$.
However the coordinates of points in projective space being all defined up
to multiplication by a constant, we need to take that into account.

\begin{definition}
	A rational map $\phi = [f_0, \dots, f_m]: V_1 \to V_2$
	is \emph{regular} at $P \in V_1$ if there is a function $g \in K(V_1)$,
	such that
	\begin{enumerate}[label=(\roman*)]
		\item each $gf_i$ is regular at $P$
		\item for some $i$, $(gf_i)(P) \neq 0$
	\end{enumerate}
	If such a $g$ exists, we set
	\begin{equation*}
		\phi(P) = [(gf_0)(P), \dots, (gf_m)(P)]
	\end{equation*}
\end{definition}

Finally, we get an equivalent definition of morphisms of projective
varieties.

\begin{proposition}
	Let $\phi = [f_1, \dots, f_m]: V_1 \to V_2$ be a rational map. Then
	$\phi$ is regular at all $P \in V_1$ if and only if
	$\phi$ is a morphism.
\end{proposition}

\begin{proof}
	Suppose first that $\phi$ is a morphism, let $P \in V_1$.
	Choose $i$ such that $\phi(P) \in U_i \subseteq V_2$, 
	where $U_i = \{[x_0, \dots, x_m] \in \proj^m \mid x_i \neq 0\}$.
	For each $j$, define the map
	\begin{align*}
		h_j: V_2\cap U_i &\to K\\
		[x_0, \dots, x_m] &\mapsto \frac{x_j}{x_i}
	\end{align*}
	By definition, $h_j \in \O(V_2\cap U_i)$.
	Since $\phi$ is a morphism, we get that
	$h_j \circ \phi = \frac{f_j}{f_i}: \phi^{-1}(V_2\cap U_i) \to K$ is regular.
	%In particular, since $f_i(u) \neq 0$ for all $u \in \phi^{-1}(V_2\cap U_i)$,
	%we get that
	%$1/f_i \in \O(\phi^{-1}(V_2\cap U_i))$.
	Setting $g = 1/f_i \in K(V_1)$, we get that
	$gf_j$ is regular at $P$ for all $j$ and $gf_i = 1 \neq 0$.
	Hence $\phi$ is regular at $P$.

	For the other implication, suppose $\phi$ is regular at all $P \in V_1$.
	Let $W \subseteq V_2$ open and $f \in \O(W)$, we have to show that
	$f\circ\phi: \phi^{-1}(W) \to K$ is regular.
	Let $P \in \phi^{-1}(W)$, then since $\phi$ is regular at $P$,
	there exists $g \in K(V_1)$ such that each $gf_i$ is regular at $P$
	and for some $i$, $(gf_i)(P) \neq 0$.
	Since $f$ is regular at $\phi(P)$, there exist polynomials
	$p, q \in K[x_0, \dots, x_n]$ homogeneous of the same degree
	with $q(\phi(P)) \neq 0$ and 
	$f(Q) = \frac{p(Q)}{q(Q)}$ for all $Q \in W\setminus q^{-1}(0)$. Then
	\begin{equation*}
		f \circ \phi = \frac{p(f_0, \dots, f_m)}{q(f_0, \dots f_m)}
		= \frac{p(gf_0, \dots, gf_m)}{q(gf_0, \dots, gf_m)}
	\end{equation*}
	We have that both $p(gf_0, \dots, gf_m)$ and $q(gf_0, \dots, gf_m)$ are
	regular. Furthermore, $q(gf_0, \dots, gf_m)(P) = q(\phi(P)) \neq 0$
	and hence we deduce that $f\circ \phi$ is regular.
	This implies that $\phi$ is a morphism.
\end{proof}

\subsection{Projective Curves}

Through most of this paper we will be looking at projective curves, which
are projective varieties of dimension one. Recall that for a projective
variety $V$, its dimension dimension is given by
\begin{align*}
	\dim V &= \dim V\cap U_i = \dim(\Gamma(V\cap U_i))
\end{align*}
where $U_i = \{X_i \neq 0\} \subset \proj^n$ is such that $U_i\cap V\neq
\emptyset$. Hence $V$ is an projective curve iff the coordinate ring
of $V \cap U_i$ is of Krull dimension 1, i.e. every non-zero prime
ideal is maximal.

By a \emph{curve} we will always mean a \emph{projective} curve, unless
stated otherwise.

\begin{proposition}
	Let $C$ be a curve and $P \in C$ a smooth point.
	Then $\O_P(C)$ is a discrete valuation ring.
\end{proposition}

\begin{proof}
	The case of plane curves was proven in the course \emph{Algebraic curves}
	(Corollary 4.4).
	For a full proof see \cite[I.5.1]{hartshorne} and \cite[9.2]{atiyah}.
\end{proof}

Since $\O_P(C)$ is a DVR we can use its valuation to define the
notion of order on $K(C)$. Recall that $K(C) = \Frac(\O_P(C))$ for
any $P \in C$.

\begin{definition}
	Let $C$ be a curve and $P \in C$ a smooth point. The \emph{valuation}
	on $\O_P(C)$ is given by
	\begin{align*}
		\ord_P: \O_P(C) &\to \N\cup\{\infty\}\\
		f &\mapsto \max\{d \in \N \mid f \in \m_P^d\}.
	\end{align*}
	where $\m_P$ is the maximal ideal of $\O_P(C)$.
	We extend this definition to $K(C)$ using
	\begin{align*}
		\ord_P: K(C) &\to \Z\cup\{\infty\}\\
		f/g &\mapsto \ord_P(f) - \ord_P(g).
	\end{align*}
	For $f \in K(C)$, we call $\ord_P(f)$ the order of $f$ at $P$.
	If $\ord_P(f) > 0$, then $f$ has a \emph{zero} at $P$,
	if $\ord_P(f) < 0$, then $f$ has a \emph{pole} at $P$,
	if $\ord_P(f) \geq 0$, then $f$ is \emph{regular} at $P$.
	
	A \emph{uniformizer} for $C$ at $P$ is a function $t \in K(C)$ with
	$\ord_P(t) = 1$ (so a generator of $\m_P$)
\end{definition}

Thanks $O_P(C)$ being a DVR, we have that smooth projective curves
have a really nice structure.
For example, we can deduce that all rational maps between a curve
and another variety is regular wherever the curve is smooth.

\begin{proposition}
	\label{prop:smooth-morphism}
	Let $C$ be a curve, $V \subseteq \proj^n$ a variety,
	$P \in C$ a smooth point, and $\phi: C \to V$ a rational map.
	Then $\phi$ is regular at $P$. In particular, if $C$ is smooth, 
	then $\phi$ is a morphism.
\end{proposition}
\begin{proof}
	Write $\phi = [f_0, \dots f_n]$ with $f_i \in K(C)$
	and choose an uniformizer $t \in K(C)$ for $C$ at $P$.
	Let 
	\begin{equation*}
		n = \min_{0 \leq i \leq n}\{\ord_P f_i\}
	\end{equation*}
	Then $\ord_P(t^{-n}f_i) \geq 0$ for all $i$ and $\ord_P(t^{-n}f_j) = 0$
	for some $j$. Hence each $t^{-n}f_i$ is regular at $P$ and
	$(t^{-n}f_j)(P) \neq 0$. So $\phi$ is regular at $P$.
\end{proof}

We also get the following theorem, which is the projective counterpart of a
similar theorem for compact Riemann surfaces.

\begin{theorem}
	\label{thm:const-surj}
	Let $\phi: C_1 \to C_2$ be a morphism of curves. Then $\phi$ is either
	constant or surjective.
\end{theorem}
\begin{proof}
	Admitted. See \cite[II.6.8]{hartshorne}.
\end{proof}

\begin{corollary}
	\label{prop:curves-poles}
	Let $C$ be a smooth curve and $f \in K(C)$. Then if $f$ has no poles,
	$f \in K$.
\end{corollary}

\begin{proof}
	We have that $f$ induces a rational map
	\begin{align*}
		[f, 1]: C&\to \proj^1\\
		P &\mapsto [f(P), 1]
	\end{align*}
	By \ref{prop:smooth-morphism}, $[f, 1]$ is a morphism and
	so by \ref{thm:const-surj}, we have that $[f, 1]$ is either constant
	or surjective. If $[f, 1]$ is constant, $f$ is constant and so $f \in K$.
	Else $[f, 1]$ is surjective, so there is some $P \in C$ such that
	$[f, 1](P) = [1, 0]$, but then $P$ is a pole of $f$.
\end{proof}

\begin{proposition}
	\label{prop:zero-finiteness}
	Let $C$ be a smooth curve and $f \in K(C)^\times$.
	Then there are only finitely 
	many points of $C$ at which $f$ has a pole or a zero.
\end{proposition}

\begin{proof}
	We have that $[f, 1]: C \to \proj^1$ is a morphism, hence continuous.
	It follows that $f^{-1}(0) = [f, 1]^{-1}([0, 1])$ is a closed subset
	of $C$. Since $f \neq 0$, we have that $f^{-1}(0) \neq C$.
	Let $U_i = \{X_i \neq 0\} \subset \proj^n$ for any $i$.
	$f^{-1}(0)\cap U_i \subset \A^n$ being closed,
	it can be written as a finite union of irreducible
	algebraic sets in $C\cap U_i \subset \A^n$.
	$C\cap U_i$ being of dimension $1$, the only irreducible algebraic
	sets strictly included in $C \cap U_i$ are singletons,
	hence $f^{-1}(0)\cap U_i$ is a finite set.
	Furthermore, $\proj^n$ can be covered by $U_i$ for $i \in \{0, \dots, n\}$.
	This shows $f$ has a finite amount of zeros.

	$f$ having a finite number of poles follows from the
	fact that $1/f$ has a finite number of zeros.
\end{proof}


Recall that a rational map $\phi: C_1 \to C_2$ induces a map fixing $K$
\begin{align*}
	\phi^*: K(C_2) &\to K(C_1)\\
	f &\mapsto f\circ\phi
\end{align*}
By the above theorem, if $\phi$ is not constant, then it is surjective
and hence $\phi^*$ is an injection.
One can show that $K(C_1) / \phi^*K(C_2)$ is a finite extension 
(see \cite[II.6.8]{hartshorne}).
It follows we can consider the norm on this extension. We can see $K(C_1)$ as a
$\phi^*K(C_2)$-vector space in which case elements of $K(C_1)$ act on
$K(C_1)$ via multiplication, which is a $\phi^*K(C_2)$-linear
transformation. The norm $N_{K(C_1)/\phi^*K(C_2)}(f)$ of an element
$f \in K(C_1)$ is then defined to be
the determinant of this $\phi^*K(C_2)$-linear transformation.
By definition, $N_{K(C_1)/\phi^*K(C_2)}(f) \in \phi^*K(C_2)$, and so by
injectivity of $\phi^*$, we can take the inverse
\begin{equation*}
	\phi_*(f) := (\phi^*)^{-1}\circ N_{K(C_1)/\phi^* K(C_2)}(f).
\end{equation*}
This defines a map of function fields 
\begin{equation*}
	\phi_*: K(C_1) \to K(C_2).
\end{equation*}

We can also consider the degree the extension $K(C_1)/\phi^*K(C_2)$,
which will define the degree of a map of curves.

\begin{definition}
	Let $\phi: C_1 \to C_2$ be a map of curves defined over $K$.
	If $\phi$ is constant, we define the \emph{degree} of $\phi$ to be $0$.
	Otherwise we define the degree of $\phi$ by
	\begin{equation*}
		\deg\phi = [K(C_1): \phi^*K(C_2)]
	\end{equation*}
	Let $S$ be the separable closure of $\phi^*K(C_2)$ inside $K(C_1)$.
	we define the \emph{separable degree} of $\phi$ to be
	\begin{equation*}
		\deg_s\phi = [S: \phi^*K(C_2)]
	\end{equation*}
	and the \emph{inseparable degree}
	\begin{equation*}
		\deg_i\phi = [K(C_1): S].
	\end{equation*}
\end{definition}

The following proposition
shows that for any injection of function fields $K(C_2) \to K(C_1)$
which fixes $K$, we
can find a (unique)
map of curves $C_1 \to C_2$, such that its pullback is this
injection. 

\begin{proposition}
	\label{prop:existence-inclusion}
	Let $C_1, C_2$ be curves and
	let $\iota: K(C_2) \to K(C_1)$ be an injection of function fields
	fixing $K$. Then there exists a unique non-constant map $\phi: C_1 \to C_2$
	such that $\phi^* = \iota$.
\end{proposition}

\begin{proof}
	Assume $C_2 \subset \proj^n$ and $C_2 \not\subset \{[X_0, \dots, X_n] \in
	\proj^n \mid X_0 = 0\}$ (we can relabel the $X_i$'s if necessary).
	Let $g_i \in K(C_2)$ defined by 
	\begin{equation*}
		g_i(X_0, \dots, X_n) = X_i/X_0.
	\end{equation*}
	Then define $\phi: C_1 \to C_2$ by
	\begin{equation*}
		\phi = [1, \iota(g_1), \dots, \iota(g_n)].
	\end{equation*}
	We then have that
	\begin{equation*}
		\phi^*(g_i) = g_i[1, \iota(g_1), \dots, \iota(g_n)]	
		= \iota(g_i)/1 = \iota(g_i)
	\end{equation*}
	Since the $K(C_2) = K(g_1, \dots, g_n)$, we deduce
	$\phi^* = \iota$.

	Suppose there is some other map $\psi = [f_0, \dots, f_n]: C_1 \to C_2$
	such that $\psi^* = \iota$. Then for each $i$,
	\begin{equation*}
		f_i/f_0 = \psi^*(g_i) = \iota(g_i),
	\end{equation*}
	which shows
	\begin{equation*}
		\psi = [1, f_1/f_0, \dots, f_n/f_0] = [1, \iota(g_1), \dots, \iota(g_n)]
		= \phi.
	\end{equation*}
\end{proof}

We also get the following useful corollary.
\begin{corollary}
	\label{cor:deg-1-isom}
	Let $C_1$ and $C_2$ be smooth curves, and let $\phi: C_1 \to C_2$
	be a map of degree 1. Then $\phi$ is an isomorphism.
\end{corollary}

\begin{proof}
	By definition we have that if $\deg \phi = 1$, then $\phi^*K(C_2) = K(C_1)$,
	hence $\phi^*$ is an isomorhism of function fields.
	In particular, from \ref{prop:existence-inclusion} applied to
	$(\phi^*)^{-1}: K(C_1) \to K(C_2)$, we get the existence
	of $\psi: C_2 \to C_1$, such that $\psi^* = (\phi^*)^{-1}$.
	Since $C_2$ is smooth, $\psi$ is a morphism by \ref{prop:smooth-morphism}.
	Since $(\phi \circ \psi)^* = \psi^* \circ \phi^* = \id_{C_2}^*$
	and $(\psi\circ \phi)^* = \phi^* \circ \psi^* = \id_{C_1}^*$,
	it follows by the unicity part of \ref{prop:existence-inclusion}
	that $\phi\circ\psi = \id_{C_2}$ and $\psi\circ\phi = \id_{C_1}$, and
	hence $\phi$ is an isomorphism.
\end{proof}

% RAMIFICATION INDEX

Now, suppose we have a non-constant map of smooth curves
$\phi: C_1 \to C_2$, then we might expect the preimage of any point $Q$
by this map to be of cardinality $\deg\phi$. However, this is not always
the case. If we imagine $\phi$ as a cover with $\deg\phi$ sheets,
it could happen that some sheets intersect above some point
$Q \in C_2$ in which case $\#\phi^{-1}(Q) < \deg\phi$.
The ramification index measures the extent to which this happens.

\begin{definition}
	Let $\phi: C_1 \to C_2$ be a non-constant map of smooth curves, and let
	$P \in C_1$. The \emph{ramification index} of $\phi$ at $P$, denoted
	$e_\phi(P)$, is given by
	\begin{equation*}
		e_\phi(P) = \ord_P(\phi^*t_{\phi(P)})
	\end{equation*}
	where $t_{\phi(P)} \in K(C_2)$ is a uniformizer at $\phi(P)$.
	We say that $\phi$ is \emph{unramified} at $P$ if $e_\phi(P) = 1$. $\phi$ is
	\emph{unramified} if it is unramified at every point $C_1$.
\end{definition}

The following proposition will make sense of the intuition we gave above.

\begin{proposition}
	\label{prop:ramification-properties}
	Let $\phi: C_1 \to C_2$ be a non-constant map of smooth curves.
	\begin{enumerate}[label=(\alph*)]
		\item For every $Q \in C_2$,
			\begin{equation*}
				\sum_{P \in \phi^{-1}(Q)}e_\phi(P) = \deg \phi
			\end{equation*}
		\item For all but finitely many $Q \in C_2$,
			\begin{equation*}
				\#\phi^{-1}(Q) = \deg_s(\phi)
			\end{equation*}
		\item Let $\psi: C_2 \to C_3$ be another non-constant map.
			Then for all $P \in C_1$,
			\begin{equation*}
				e_{\psi\circ\phi}(P) = e_{\phi}(P)e_{\psi}(\phi(P))
			\end{equation*}
	\end{enumerate}
\end{proposition}

\begin{proof}
	Admitted. See \cite[II.2.6]{silverman}.
\end{proof}

In particular, if $\phi$ is separable, then for all but finitely many
$Q \in C_2$, we get that $\#\phi^{-1}(Q) = \deg(\phi)$. Intuitively this means
that the sheets of the cover $\phi$ intersect at a finite amount 
of points. This already hints at the fact that separability is
a very important property of maps between smooth curves, as it will allow us
to count points in the maps' preimages.

% FROBENIUS MORPHISM

Next, we will define the so-called Frobenius morphism.
This morphism is going to play a central role in the proof of the Weil
conjectures for elliptic curves, as it will allow us to count
the number of points of the curve that lie over some finite field.

\begin{definition}
	Suppose $\chr(K) = p \neq 0$ and let $q = p^r$.
	For any polynomial $f \in K[X]$ define $f^{(q)}$ to be the polynomial
	obtained from $f$ by raising each coefficient of 
	$f$ to the $q$\ts{th} power.
	For any curve $C/K$ we can define a new curve $C^{(q)}/K$ corresponding
	to the ideal generated by $\{f^{(q)}: f \in I(C)\}$.	

	The $q$\ts{th}-\emph{power Frobenius morphism} is defined by
	\begin{align*}
		\phi: C &\to C^{(q)}\\
		[x_0, \dots, x_n] &\mapsto [x_0^q, \dots, x_n^q]
	\end{align*}
	This map is well defined as for any $P = [x_0, \dots, x_n] \in C$, and
	for any generator $f^{(q)}$ of $I(C^{(q)})$,
	\begin{align*}
		f^{(q)}(\phi(P)) &= f^{(q)}(x_0^q, \dots, x_n^q)\\
		&= (f(x_0, \dots, x_n))^q&\textrm{since }\chr(K) = p\\
		&= (f(P))^q = 0
	\end{align*}
	
	Notice that if
	$C$ is defined over $\F_q \subset K$, then $C^{(q)} = C$,
	and $\phi$ becomes and endomorphism.
\end{definition}

In the case where $C$ is defined over $\F_q$, the Frobenius map $\phi_q$
gives us a way to find $C(\F_q)$. Indeed, the $q$\ts{th} power map
on $\cl{\F_q}$ fixes exactly $\F_q$ (see course on Rings and Fields),
hence we see that the set of fixed points of $\phi_q$ is exactly $C(\F_q)$
This will play an important role in computing $\#C(\F_q)$.

\subsection{Divisors}

We will now define so-called divisors. These give us a practical way
to talk about zeroes and poles of functions and will be very useful when
defining a group structure on elliptic curves.

\begin{definition}
	The \emph{divisor group of a curve} $C$, denoted $\Div(C)$ is the free
	abelian group generated by the points of $C$. We write $D \in \Div(C)$ as
	the formal sum
	\begin{equation*}
		D = \sum_{P \in C} n_P\cdot(P)
	\end{equation*}
	with $n_P \in \Z$ and $n_P = 0$ for all but finitely many $P \in C$.

	The \emph{degree} of $D$ is defined by
	\begin{equation*}
		\deg D = \sum_{P \in C} n_P.
	\end{equation*}
	The \emph{divisors of degree} 0 form a subgroup of $\Div(C)$, which we denote
	by
	\begin{equation*}
		\Div^0(C) = \{D \in \Div(C) \mid \deg D = 0\}.
	\end{equation*}
\end{definition}

We can associate to each function $f \in K(C)^\times$ a divisor, which carries
the information about the order of zeros and poles of $f$.

\begin{definition}
	Let $C$ be a smooth curve and $f \in K(C)\setminus\{0\}$. We
	associate to $f$ the divisor $\div(f)$ given by
	\begin{equation*}
		\div(f) = \sum_{P \in C}\ord_P(f)\cdot(P)
	\end{equation*}
	Proposition \ref{prop:zero-finiteness} guarantees that this is well
	defined.
\end{definition}

\begin{remark}
	Since each $\ord_P$ is a valuation, the map
	\begin{equation*}
		\div: K(C)^\times \to \Div(C)
	\end{equation*}
	is a homomorphism of abelian groups.
\end{remark}

In fact, as we will soon see, not all divisors correspond to functions
in this way. The divisors that do form a subgroup.

\begin{definition}
	A divisor $D \in \Div(C)$ is \emph{principal} if it has the form
	$D = \div(f)$ for some $f \in K(C)$. The subgroup of principal divisors
	is denoted $\PDiv(C)$
	Two divisors $D_1, D_2$ are \emph{linearly equivalent}, which we denote
	$D_1 \sim D_2$, if $D_1 - D_2$ is principal.
\end{definition}

% DEFINITION MAP OF DIVISORS

In a way analogous to how a map between smooth curves $\phi: C_1 \to C_2$
induces maps on function fields
\begin{equation*}
	\phi_*: K(C_1) \to K(C_2)
	\qquad\textrm{and}\qquad
	\phi^*: K(C_2) \to K(C_1),
\end{equation*}
we can define maps between divisor groups.

\begin{definition}
	Let $\phi: C_1 \to C_2$ be a non-constant between smooth curves.
	Then $\phi$ induces maps between the divisor groups of $C_1$ and $C_2$.
	The \emph{pullback} is defined by
	\begin{align*}
		\phi^*: \Div(C_2) &\to \Div(C_1)\\
		(Q) &\mapsto \sum_{P \in \phi^{-1}(Q)}e_\phi(P)\cdot(P).
	\end{align*}
	The \emph{pushforward} is defined by
	\begin{align*}
		\phi_*: \Div(C_1) &\to \Div(C_2)\\
		(P) &\mapsto (\phi P).
	\end{align*}
\end{definition}

These maps have many useful properties, as the following proposition shows.

\begin{proposition}
	\label{prop:divisor-map-properties}
	Let $\phi: C_1 \to C_2$ be a non-constant map of smooth curves.
	\begin{enumerate}[label=(\alph*), itemsep=0em]
		\item $\deg(\phi^*D) = (\deg\phi)(\deg D)$ for all $D \in \Div(C_2)$.
		\item $\phi^*(\div f) = \div(\phi^* f)$ for all $f \in K(C_2)^\times$.
		\item $\deg(\phi_*D) = \deg(D)$ for all $D \in \Div(C_1)$.
		\item $\phi_*(\div f) = \div(\phi_* f)$ for all $f\in K(C_1)^\times$
		\item $\phi_*\circ \phi^*$ acts as multiplication by $\deg \phi$
			on $\Div(C_2)$
		\item If $\psi: C_2\to C_3$ is another such map,
			then
			\begin{equation*}
				(\psi\circ\phi)^* = \phi^*\circ\psi^*
				\qquad\textrm{and}\qquad
				(\psi\circ\phi)_* = \phi_*\circ\psi_*
			\end{equation*}
	\end{enumerate}
\end{proposition}
\begin{proof}
	\begin{enumerate}[label=(\alph*), itemsep=0em]
		\item We have that if $D = \sum n_Q(Q)$,
			\begin{equation*}
				\phi^*D = \sum_{Q \in C_2}n_Q\sum_{P \in \phi^{-1}(Q)}
				e_\phi(P)\cdot(P).
			\end{equation*}
			From \ref{prop:ramification-properties}(a) it follows that
			\begin{equation*}
				\deg(\phi^*D) = \sum_{Q \in C_2}n_Q\deg(\phi) = \deg(D)\deg(\phi).
			\end{equation*}
		\item Let $P\in C_1$, and let $t_{\phi(P)}$ be an uniformizer 
			at $\phi(P)$. Then let $k = \ord_{\phi(P)}(f)$, we have that
			$f = t_{\phi(P)}^k g$ for some $g$ of order $0$ at $\phi(P)$.
			It follows that
			\begin{align*}
				\ord_P(\phi^*f) &= \ord_P((\phi^*t_{\phi(P)})^k(\phi^*g))\\
				&= \ord_P(\phi^*t_{\phi(P)})\cdot k + \ord_P(\phi^*g)\\
				&= e_\phi(P)\ord_{\phi(P)}(f),
			\end{align*}
			since $\phi^*g$ is regular at $P$, since $\phi$ is a morphism.
			Then we get
			\begin{align*}
				\div(\phi^*f) &= \sum_{P \in C_1} \ord_P(\phi^*f)\cdot(P)\\
				&= \sum_{P \in C_1} e_\phi(P)\ord_{\phi(P)}(f)\cdot(P)\\
				&= \sum_{Q \in C_2} \sum_{P \in \phi^{-1}(Q)}
				e_\phi(P)\ord_{Q}(f)\cdot(P)\\
				&= \phi^*(\div f).
			\end{align*}
		\item Clear from the definition of $\phi_*$.
		\item Admitted. See \cite[II.3.6(d)]{silverman}.
		\item For all $Q \in C_2$, using \ref{prop:ramification-properties}(a),
			\begin{align*}
				\phi_*\circ\phi^*((Q)) &= \phi_*\left(
				\sum_{P \in \phi^{-1}(Q)}e_\phi(P)\cdot(P)\right)\\
				&= \sum_{P \in \phi^{-1}(Q)}e_\phi(P)\cdot(Q)\\
				&= \deg(\phi)\cdot(Q).
			\end{align*}
		\item Let $R \in C_3$, then using \ref{prop:ramification-properties}(c),
			\begin{align*}
				(\psi\circ\phi)^*(R) &= \sum_{P \in (\psi\circ\phi)^{-1}}
				e_{\psi\circ\phi}(P)\cdot(P)\\
				&= \sum_{P \in (\psi\circ\phi)^{-1}}
				e_{\phi}(P)e_\psi(\phi(P))\cdot(P)\\
				&= \sum_{Q \in \psi^{-1}(R)}\sum_{P \in \phi^{-1}(Q)}
				e_{\phi}(P)e_\psi(Q)\cdot(P)\\
				&= \phi^*\circ\psi^*(R).
			\end{align*}
			The second equality follows clearly from definition.
	\end{enumerate}
\end{proof}

Thanks to these properties, we can show that principal divisors have degree
0, making $\PDiv(C)$ a subgroup of $\Div^0(C)$.

\begin{proposition}
	Let $D \in \Div(C)$ be a principal divisor, then $\deg D = 0$.
\end{proposition}

\begin{proof}
	Let $f \in K(C)^\times$ such that $D = \div f$. It follows from the
	definition of $\div$ and \ref{prop:divisor-map-properties}(b) that
	\begin{equation*}
		\deg \div(f) = \deg([f, 1]^*((0) - (\infty)))
		= \deg([f, 1]) - \deg([f, 1]) = 0
	\end{equation*}
	Hence $\deg D = 0$
\end{proof}

We now define the notion of divisor class group. Essentially, we identify
linearly equivalent divisors. This will come in handy as it will allow us
to define a group law on elliptic curves.

\begin{definition}
	The \emph{divisor class group} of a curve $C$,
	denoted $\Cl(C)$, is the quotient $\Div(C)/\PDiv(C)$.
	Principal divisors have degree $0$ and hence it makes sense to speak about
	the degree of elements in $\Cl(C)$. The sugroup of elements of $\Cl(C)$ of
	degree $0$ is denoted $\Cl^0(C)$.
\end{definition}

\begin{remark}
	By \ref{prop:divisor-map-properties}, for $\phi: C_1\to C_2$ a non-constant
	map of smooth curves, $\phi_*$ and $\phi^*$ take degree 0 divisors to degree
	0 divisors and principal divisors to principal divisors.
	In particular, they induce the maps
	\begin{equation*}
		\phi^*: \Cl^0(C_2) \to \Cl^0(C_1)
		\qquad\textrm{and}\qquad
		\phi_*: \Cl^0(C_1) \to \Cl^0(C_2)
	\end{equation*}
\end{remark}

Divisor allow us to express certain conditions on the zeroes and poles
of a function. To do this we define a partial order on $\Div(C)$, which will
allow us to compare divisors.

\begin{definition}
	A divisor $D = \sum n_P(P) \in \Div(C)$ is \emph{positive} (or
	\emph{effective}), denoted by
	$D \geq 0$, if $n_P \geq 0$ for all $P \in C$.
	For two divisors $D_1, D_2 \in \Div(C)$, we write $D_1 \geq D_2$
	to indicate that $D_1 - D_2$ is positive.
\end{definition}

We may for example demand that a function $f$
has poles of order less than $n_P$ at $P \in E$.
We can encode this information in a divisor $D = \sum n_P(P)$,
which allows us to express this condition neatly as
$\div(f) \geq -D$. In fact, we have a notation for the set
of functions that satisfy such a condition.

\begin{definition}
	Let $D \in \Div(C)$. We associate to $D$ the set of functions
	\begin{equation*}
		\L(D) = \{f \in K(C)^\times: \div(f) \geq -D\} \cup \{ 0 \}.
	\end{equation*}
	It can be shown $\L(D)$ is a finite-dimensional
	$K$-vector space. We denote its dimension by
	\begin{equation*}
		l(D) = \dim_K \L(D).
	\end{equation*}
\end{definition}

\begin{proposition}
	\label{prop:L-prop}
	If $\deg D < 0$, then $\L(D) = \{0\}$ and $l(D) = 0$.
\end{proposition}

\begin{proof}
	Suppose ad absurdum there is some $f \in \L(D) \setminus \{0\}$.
	Then $\div f \geq -D$ and so in particular
	\begin{equation*}
		0 = \deg \div f \geq \deg(-D) = -\deg D > 0,
	\end{equation*}
	but this is absurd.
\end{proof}

\subsection{Differentials}

In this section we introduce the notion of differential forms on a curve.
This will allow us to state the Riemann-Roch theorem and define the genus of a
curve. Furthermore, differentials turn out to be very useful for determining
when map between curves is separable.
For the goals of this paper, it will suffice to gloss over the main definitions
and properties without providing proofs.

\begin{definition}
	Let $C$ be a curve. 
	The \emph{space of (meromorphic)} differential forms on $C$, denoted
	$\Omega_C$, is the $K(C)$-vector space generated by symbols of the form
	$df$ for $f\in K(C)$, subject to the following relations:
	\begin{enumerate}[itemsep=0em]
		\item $d(x + y) = dx + dy$
		\item $d(xy) = x\,dy + y\,dx$
		\item $da = 0$
	\end{enumerate}
	for all $x, y \in K(C)$ and $a \in K$.
\end{definition}

A non-constant map of curves $\phi:C_1 \to C_2$ (again) induces a map
on the spaces of differential forms.

\begin{definition}
	Let $\phi: C_1 \to C_2$ be a non-constant map of curves. Then $\phi$ induces
	maps between the spaces of meromorphic forms of $C_1$ and $C_2$.
	The \emph{pullback} is defined by
	\begin{align*}
		\phi^*: \Omega_{C_2} &\to \Omega_{C_1}\\
		fdx &\mapsto (\phi^* f)\,d(\phi^* x)
	\end{align*}
\end{definition}

Since a curve is one-dimensional, we might expect its space of differential
forms to also be one-dimensional. And indeed, that is the case.

\begin{proposition}
	\label{prop:forms-dimension}
	Let $C$ be a curve, then $\Omega_C$ is a 1-dimensional $K(C)$-vector space.
	Furthermore, if $t \in K(C)$ is a uniformizer at $P$,
	then $dt$ generates $\Omega_C$.
\end{proposition}
\begin{proof}
	See \cite[II.1.4, II.4.2]{silverman}
\end{proof}

This gives us a correspondence between differential forms and functions
on $C$.

\begin{notation}
	Let $\omega \in \Omega_C$. Then by \ref{prop:forms-dimension} there exists
	$g \in K(C)$ such that $\omega = g\,dt$. We denote $g$ by $\omega/dt$.
\end{notation}

Using this identification, we may define the order of a differntial.
A priori this may depend on the choice of uniformizer, but the following
proposition says that's not the case.
\begin{proposition}
	Let $P \in C$ and $t \in K(C)$ a uniformizer at $P$. For $\omega \in
	\Omega_C$,
	the quantity
	\begin{equation*}
		\ord_P(\omega/dt)
	\end{equation*}
	is independent of the choice of uniformizer $t$.
\end{proposition}
\begin{proof}
	See \cite[II.4.3(c)]{silverman}
\end{proof}

\begin{definition}
	We call $\ord_P(\omega/dt)$ the order of $\omega$ at $P$ and denote it by
	$\ord_P(\omega)$.
\end{definition}

Notice that if $t \in K(C)$ is a uniformizer at $P \in C$, then
$\ord_P(dt) = \ord_P(dt/dt) = \ord_P(1) = 0$ by definition.

\begin{proposition}
	For all but finitely many $P \in \C$, 
	\begin{equation*}
		\ord_P(\omega) = 0.
	\end{equation*}
\end{proposition}

\begin{proof}
	Follows directly from \ref{prop:zero-finiteness}.
\end{proof}

This proposition guarantees that the divisor of a differential is
well defined.
\begin{definition}
	Let $\omega \in \Omega_C$. The divisor associated to $\omega$ is
	\begin{equation*}
		\div(\omega) = \sum_{P \in C} \ord_P(\omega)\cdot (P) \in \Div(C)
	\end{equation*}
\end{definition}


\begin{definition}
	A differential $\omega \in \Omega_C$ is \emph{regular} 
	(or \emph{holomorphic})
	if for all $P \in C$,
	\begin{equation*}
		\ord_P(\omega) \geq 0.
	\end{equation*}
	If is \emph{non-vanishing} if for all $P \in C$,
	\begin{equation*}
		\ord_P(\omega) \leq 0.
	\end{equation*}
\end{definition}

The case of $\proj^1$ is an important example.
\begin{example}
	\label{ex:proj-holomorphic}
	Let $t:\proj^1 \to K, [X, Y]\mapsto X/Y$ be the coordinate function on
	$\proj^1$. Then $t - \alpha$ is an uniformizer at $[\alpha, 1]$.
	It follows that
	\begin{equation*}
		\ord_{[\alpha, 1]}(dt) = \ord_{[\alpha, 1]}(d(t - \alpha)) = 0.
	\end{equation*}
	At $\infty = [1, 0]\in \proj^1$, we have that $1/t$ is a uniformizer.
	Furthermore,
	\begin{equation*}
		0 = d(1) = d(t/t) = 1/t\cdot dt + td(1/t)
	\end{equation*}
	and hence $dt = -t^2d(1/t)$. It follows that 
	\begin{equation*}
		\ord_{\infty}(dt) = \ord_{\infty}(-t^2d(1/t)) = 
		\ord_{\infty}(-t^2) = -2
	\end{equation*}
	Hence we obtain $\div(dt) = -2(\infty)$ and hence $dt$ is not holomorphic.
	But for any non-zero $\omega \in \Omega_{\proj^1}$, 
	we have that there exists some $g \in K(\proj^1)$ such that 
	$\omega = gdt$, but then
	\begin{equation*}
		\deg\div \omega = \deg(\div(g) + \div(dt)) = -2
	\end{equation*}
	so $\omega$ is not holomorphic either.
	Hence there are no non-zero holomorphic differentials on $\proj^1$.
\end{example}

Now, if $\omega_1$ and $\omega_2 \in \Omega_C$ are non-zero differentials, then
there exists $f\in K(C)^\times$ such that $\omega_1 = f\omega_2$.
This implies that
\begin{equation*}
	\div(\omega_1) = \div(f) + \div(\omega_2).
\end{equation*}
It follows that the divisors of all differentials are in the same class in
$\Cl(C)$ and so the following definition makes sense.

\begin{definition}
	The \emph{canonical divisor class} on $C$ is the image in $\Cl(C)$ of
	$\div(\omega)$ for any non-zero differential $\omega \in \Omega_C$.
	Any divisor in this class is called a \emph{canonical divisor}.
\end{definition}

\subsection{Genus of a Curve and the Riemann-Roch Theorem}

We can finally define what the genus of a curve is.
\begin{definition}
	Let $C$ be a curve, let $K_C$ be a canonical divisor,
	the \emph{genus} of $C$ is defined to be $\dim_K \L(K_C) = l(K_C)$.
\end{definition}

\begin{example}
	\label{ex:proj-genus}
	The projective line $\proj^1$ has genus 0.
	Let $K_C = \div(\omega)$ be a canonical divisor of $\proj^1$.
	By \ref{ex:proj-holomorphic}, $\deg(K_C) < 0$. In particular, 
	since $\deg \div f = 0$ for all $f \in K(C)^\times$,
	$\div f \not\geq -K_C$,
	so $f \notin \L(K_C)$. It follows that $\L(K_C) = \{0\}$ and
	hence $l(K_C) = 0$.
\end{example}

The genus is an important invariant \comment{Do I have to show it is an
invariant?} of algebraic curves.
For example, we have the Riemann-Roch theorem, which will
allow us to calculate $l(D)$ for any divisor $D$ if we know the genus of
the curve.
This will be very useful, as it will allow us to show that elliptic curves,
which are by definition smooth curves of genus 1, are
isomorphic to plane curves given by a specific cubic equation.
\begin{theorem}[Riemann-Roch]
	\label{thm:riemann-roch}
	Let $C$ be a smooth curve of genus $g$ and $K_C$ a canonical divisor on $C$.
	Then for every divisor $D \in \Div(C)$,
	\begin{equation*}
		l(D) - l(K_C - D) = \deg D - g + 1.
	\end{equation*}
\end{theorem}
\begin{proof}
	Admitted. See \cite[IV.1.3]{hartshorne}
\end{proof}

We get also the following corollary, part (b) being especially useful
because it will allow us to avoid working
with canonical divisors.

\begin{corollary}
	\label{cor:riemann-roch}
	In the same setup as the Riemann-Roch theorem, we have the following properties
	\begin{enumerate}[itemsep=0em, label=(\alph*)]
		\item $\deg K_C = 2g - 2$.
		\item If $\deg(D) > 2g - 2$, we have that
			\begin{equation*}
				l(D) = \deg(D) - g + 1
			\end{equation*}	
	\end{enumerate}
\end{corollary}

\begin{proof}
	\begin{enumerate}[itemsep=0em, label=(\alph*)]
		\item From definition, $l(K_C) = g$, so for $D = K_C$ and using 
			$l(0) = 1$, since $\L(0) = 0$ by \ref{prop:curves-poles}, we get the
			result using $\ref{thm:riemann-roch}$.
		\item From (a), we have that $\deg(K_C - D) < 0$. From
			\ref{prop:L-prop}, we have that $l(K_C - D) = 0$ and so
			from \ref{thm:riemann-roch}, the result follows.
	\end{enumerate}
\end{proof}

For example, we get that for curves of genus 1, if $\deg(D) > 0$,
then $l(D) = \deg(D)$, from which we can deduce many useful properties, such
as the following.

\begin{proposition}
	\label{prop:sim-implies-eq}
	Let $C$ be a curve of genus 1, and let $P, Q \in C$. Then
	\begin{equation*}
		(P) \sim (Q)
		\quad\textrm{if and only if}\quad
		P = Q
	\end{equation*}
\end{proposition}

\begin{proof}
	Suppose $(P) \sim (Q)$, then there exists some $f \in K(C)$ such that
	\begin{equation*}
		\div(f) = (P) - (Q).
	\end{equation*}
	We have that $f \in \L((Q))$ and by Riemann-Roch (\ref{cor:riemann-roch}),
	it follows that
	\begin{equation*}
		\dim \L((Q)) = \deg((Q)) - g + 1 = 1.
	\end{equation*}
	Since $\L((Q))$ already contains the constant functions, $f \in \L((Q)) = K$
	and so $P = Q$.
\end{proof}

Thanks to the Riemann-Roch theorem, we can also link the genera of 
curves that admit some non-constant separable map between them.
The following theorem makes this concrete.
\begin{theorem}[Riemann-Hurwitz]
	Let $C_1, C_2$ be smooth curves of genus $g_1, g_2$ respectively.
	Let $\phi: C_1 \to C_2$ be a non-constant separable map, then
	\begin{equation*}
		2g_1 - 2 \geq (\deg \phi) (2g_2 - 2) + \sum_{P \in C_1}(e_\phi(P) - 1).
	\end{equation*}
	Furthermore, the above is an equality if and only if either:
	\begin{enumerate}[itemsep=0em, label=(\roman*)]
		\item $\chr(K) = 0$, or
		\item $\chr(K) = p > 0$ and $p$ does not divide $e_\phi(P)$ for all
			$P \in C_1$.
	\end{enumerate}
\end{theorem}
\comment{Prove?}

For our purposes, the inequality in the Riemann-Hurwitz formula
will always be an equality, as we can always suppose $\chr(K)$ to be
zero, or large enough.

Using the Riemann-Hurwitz formula, we get a very simple formula describing
the genus of a plane curve.
\begin{corollary}
	\label{cor:genus-formula}
	Let $F \in K[X, Y, Z]$ be homogeneous of degree $d \geq 1$, and suppose that
	the curve $C$ in $\proj^2$ given by the equation $F = 0$ is non-singular.
	Then
	\begin{equation*}
		\genus(C) = \frac{(d-1)(d-2)}{2}.
	\end{equation*}
\end{corollary}

\begin{proof}
	\comment{Need proof}
\end{proof}


